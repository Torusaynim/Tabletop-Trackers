<!DOCTYPE html>

<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Buckshot Roulette</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
<style>
    .bullet {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: inline-block;
      margin: 0 4px;
    }
    .live {
      background-color: red;
    }
    .blank {
      background-color: lightgray;
    }
    .heart {
      color: red;
      font-size: 20px;
    }
    .player-active {
      border: 2px solid blue;
    }
  </style>
</head>
<body class="bg-light p-4">
<div class="container">
<h1 class="mb-4">Buckshot Roulette Tracker</h1>
<div class="row mb-4">
<div class="col">
<label>–í—Å–µ–≥–æ –≤—ã—Å—Ç—Ä–µ–ª–æ–≤</label>
<input class="form-control" id="totalBullets" type="number" value="6"/>
</div>
<div class="col">
<label>–ë–æ–µ–≤—ã—Ö –≤—ã—Å—Ç—Ä–µ–ª–æ–≤</label>
<input class="form-control" id="liveBullets" type="number" value="2"/>
</div><div class="col">
<label>–ú–∞–∫—Å. –ø—Ä–µ–¥–º–µ—Ç–æ–≤</label>
<input class="form-control" id="maxItemsPerPlayer" type="number" value="5"/>
</div>
<div class="col">
<label>–ñ–∏–∑–Ω–µ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</label>
<input class="form-control" id="defaultHearts" type="number" value="3"/>
</div>
<div class="col">
<label>–ü—Ä–µ–¥–º–µ—Ç–æ–≤ –Ω–∞ –∏–≥—Ä–æ–∫–∞</label>
<input class="form-control" id="itemsPerPlayer" type="number" value="2"/>
</div>
<div class="col d-flex align-items-end gap-2">
<button class="btn btn-primary" onclick="generateBullets()">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
<button class="btn btn-secondary" onclick="addPlayer()">–î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞</button>
</div>
</div>
<div class="text-center mb-4" id="chamber"></div>
<div class="row" id="players"></div>
<div class="text-center mt-4">
<button class="btn btn-warning me-2" onclick="assignItems()">–í—ã–¥–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç—ã</button>
<button class="btn btn-success" onclick="nextTurn()">–°–ª–µ–¥—É—é—â–∏–π —Ö–æ–¥</button>
</div>
</div>
<script>
    let players = [];
    let chamber = [];
    let currentPlayerIndex = 0;

    function generateBullets() {
      const total = parseInt(document.getElementById('totalBullets').value);
      const live = parseInt(document.getElementById('liveBullets').value);
      chamber = Array(total).fill('blank');
      let count = 0;
      while (count < live) {
        const index = Math.floor(Math.random() * total);
        if (chamber[index] === 'blank') {
          chamber[index] = 'live';
          count++;
        }
      }
      updateChamber();
      updatePlayers();
    }

    function updateChamber() {
      const container = document.getElementById('chamber');
      container.innerHTML = '';
      chamber.forEach(b => {
        const div = document.createElement('div');
        div.className = `bullet ${b}`;
        container.appendChild(div);
      });
    }

    function addPlayer() {
      const hearts = parseInt(document.getElementById('defaultHearts').value);
      players.push({ name: `–ò–≥—Ä–æ–∫ ${players.length + 1}`, hearts, items: [] });
      updatePlayers();
    }

    function changeHearts(index, delta) {
      players[index].hearts = Math.max(0, players[index].hearts + delta);
      if (players[index].hearts === 0) {
        alert(players[index].name + " –≤—ã–±—ã–ª –∏–∑ –∏–≥—Ä—ã!");
        players.splice(index, 1);
        if (currentPlayerIndex >= players.length) currentPlayerIndex = 0;
      }
      updatePlayers();
    }

    function shoot(index) {
      if (chamber.length === 0) {
        alert('–ë–∞—Ä–∞–±–∞–Ω –ø—É—Å—Ç! –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –≤—ã—Å—Ç—Ä–µ–ª—ã.');
        return;
      }

      const bullet = chamber.shift();
      const isSelfShot = index === currentPlayerIndex;

      if (bullet === "live") {
        let damage = 1;
        if (players[currentPlayerIndex]._doubleDamage) {
          damage = 2;
          players[currentPlayerIndex]._doubleDamage = false;
          alert(`${players[index].name} –ø–æ–ª—É—á–∞–µ—Ç —É–¥–≤–æ–µ–Ω–Ω—ã–π —É—Ä–æ–Ω –∏–∑-–∑–∞ –†—É—á–Ω–æ–π –ø–∏–ª—ã! üí•üí•`);
        } else {
          alert(`${players[index].name} –ø–æ–ª—É—á–∏–ª –±–æ–µ–≤—É—é –ø—É–ª—é! üí•`);
        }

        players[index].hearts = Math.max(0, players[index].hearts - damage);

        if (players[index].hearts === 0) {
          alert(players[index].name + " –≤—ã–±—ã–ª –∏–∑ –∏–≥—Ä—ã!");
          players.splice(index, 1);
          if (index <= currentPlayerIndex && currentPlayerIndex > 0) {
            currentPlayerIndex--;
          }
        }
      } else {
        alert(`${players[index].name} –æ—Ç–¥–µ–ª–∞–ª—Å—è —Ö–æ–ª–æ—Å—Ç—ã–º. üòå`);
      }

      updateChamber();
      updatePlayers();

      if (!isSelfShot || bullet === "live") {
        nextTurn();
      }
    }

    function updatePlayers() {
      const container = document.getElementById('players');
      container.innerHTML = '';
      players.forEach((player, i) => {
        const col = document.createElement('div');
        col.className = 'col-md-4 mb-3';
        const card = document.createElement('div');
        card.className = `card p-3 ${i === currentPlayerIndex ? 'player-active' : ''}`;

        const name = document.createElement('input');
        name.className = 'form-control mb-2';
        name.value = player.name;
        name.oninput = () => { players[i].name = name.value };

        const hearts = document.createElement('div');
        for (let h = 0; h < player.hearts; h++) {
          const heart = document.createElement('span');
          heart.className = 'heart me-1';
          heart.textContent = '‚ù§Ô∏è';
          hearts.appendChild(heart);
        }

        const controls = document.createElement('div');
        controls.className = 'btn-group mt-2';
        const plus = document.createElement('button');
        plus.className = 'btn btn-outline-success';
        plus.textContent = '+1';
        plus.onclick = () => changeHearts(i, 1);

        const minus = document.createElement('button');
        minus.className = 'btn btn-outline-danger';
        minus.textContent = '-1';
        minus.onclick = () => changeHearts(i, -1);

        const shootBtn = document.createElement('button');
        shootBtn.className = 'btn btn-outline-warning';
        shootBtn.textContent = '–í—ã—Å—Ç—Ä–µ–ª';
        shootBtn.onclick = () => shoot(i);

        controls.appendChild(plus);
        controls.appendChild(minus);
        controls.appendChild(shootBtn);


        card.appendChild(name);
        card.appendChild(hearts);
if (player.items && player.items.length > 0) {
          const itemHeader = document.createElement("div");
          itemHeader.innerHTML = "<strong>–ü—Ä–µ–¥–º–µ—Ç—ã:</strong>";
          card.appendChild(itemHeader);
          const itemGrid = document.createElement("div");
          itemGrid.className = "d-flex flex-wrap justify-content-start";

          player.items.forEach((item, itemIdx) => {
            const btn = document.createElement("button");
            btn.className = "btn btn-outline-dark m-1 d-flex flex-column align-items-center justify-content-center";
            btn.style.width = "47%";
            btn.style.textAlign = "center";
            btn.onclick = () => useItem(i, item, itemIdx);

            const img = document.createElement("img");
            img.src = `img/buckshot/${item}.png`;
            img.alt = item;
            img.style.width = "100px";
            img.style.height = "100px";

            const label = document.createElement("div");
            label.style.fontSize = "12px";
            label.textContent = item;

            btn.appendChild(img);
            btn.appendChild(label);
            itemGrid.appendChild(btn);
          });

          card.appendChild(itemGrid);
        }
        
        card.appendChild(controls);
        col.appendChild(card);
        container.appendChild(col);
      });
    }

    function nextTurn() {
  if (players.length === 0) return;

  let attempts = 0;
  do {
    currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
    attempts++;
  } while (players[currentPlayerIndex]._skipNextTurn && attempts <= players.length);

  const player = players[currentPlayerIndex];
  if (player._skipNextTurn) {
    alert(`${player.name} –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Ö–æ–¥ –∏–∑-–∑–∞ –Ω–∞—Ä—É—á–Ω–∏–∫–æ–≤!`);
    player._skipNextTurn = false;
    nextTurn();
    return;
  }

  updatePlayers();
}
  
const itemList = [
  "–ë–∞–Ω–∫–∞ –ø–∏–≤–∞",
  "–†—É—á–Ω–∞—è –ø–∏–ª–∞",
  "–ù–∞—Ä—É—á–Ω–∏–∫–∏",
  "–õ—É–ø–∞",
  "–ü–∞—á–∫–∞ —Å–∏–≥–∞—Ä–µ—Ç",
  "–®–ø—Ä–∏—Ü –∞–¥—Ä–µ–Ω–∞–ª–∏–Ω–∞",
  "–û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω",
  "–ò–Ω–≤–µ—Ä—Ç–æ—Ä",
  "–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω–æ–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–æ"
];

function assignItems() {
  const count = parseInt(document.getElementById('itemsPerPlayer').value);
  const max = parseInt(document.getElementById('maxItemsPerPlayer').value);
  players.forEach(player => {
    const shuffled = [...itemList].sort(() => 0.5 - Math.random());
    player.items = [...player.items, ...shuffled.slice(0, count)].slice(0, max);
  });
  updatePlayers();
}

function useItem(index, item, itemIdx) {
  const player = players[index];
  switch(item) {
    case "–ë–∞–Ω–∫–∞ –ø–∏–≤–∞":
      if (chamber.length > 0) {
        alert(player.name + " –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ë–∞–Ω–∫—É –ø–∏–≤–∞ –∏ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –ø–∞—Ç—Ä–æ–Ω.");
        chamber.shift();
        updateChamber();
      }
      break;
    case "–†—É—á–Ω–∞—è –ø–∏–ª–∞":
      player._doubleDamage = true;
      alert(player.name + " –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –†—É—á–Ω—É—é –ø–∏–ª—É: —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–Ω —É–¥–≤–æ–µ–Ω.");
      break;
    case "–ù–∞—Ä—É—á–Ω–∏–∫–∏":
      const options = players.map((p, idx) => `${idx + 1}: ${p.name}`).join("\n");
      const target = prompt("–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞ –¥–ª—è –Ω–∞—Ä—É—á–Ω–∏–∫–æ–≤:\n" + options);
      const tIdx = parseInt(target) - 1;
      if (!isNaN(tIdx) && players[tIdx]) {
        players[tIdx]._skipNextTurn = true;
        alert(players[tIdx].name + " –ø—Ä–æ–ø—É—Å—Ç–∏—Ç —Å–ª–µ–¥—É—é—â–∏–π —Ö–æ–¥!");
      }
      break;
    case "–õ—É–ø–∞":
      if (chamber.length > 0) alert("–°–ª–µ–¥—É—é—â–∏–π –ø–∞—Ç—Ä–æ–Ω: " + (chamber[0] === 'live' ? "–±–æ–µ–≤–æ–π" : "—Ö–æ–ª–æ—Å—Ç–æ–π"));
      else alert("–ë–∞—Ä–∞–±–∞–Ω –ø—É—Å—Ç");
      break;
    case "–ü–∞—á–∫–∞ —Å–∏–≥–∞—Ä–µ—Ç":
      player.hearts += 1;
      alert(player.name + " –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç 1 –∑–¥–æ—Ä–æ–≤—å—è.");
      break;
    case "–®–ø—Ä–∏—Ü –∞–¥—Ä–µ–Ω–∞–ª–∏–Ω–∞":
      const victimOptions = players.map((p, idx) => `${idx + 1}: ${p.name}`).join("\n");
      const targetNum = prompt("–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞ –¥–ª—è –∫—Ä–∞–∂–∏ –ø—Ä–µ–¥–º–µ—Ç–∞:\n" + victimOptions);
      const victimIdx = parseInt(targetNum) - 1;
      if (!isNaN(victimIdx) && players[victimIdx] && players[victimIdx].items?.length) {
        const itemsList = players[victimIdx].items.map((itm, i) => `${i + 1}: ${itm}`).join("\n");
        const itemNum = prompt("–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç —É " + players[victimIdx].name + " (–≤–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä):\n" + itemsList);
        const itemIdxToSteal = parseInt(itemNum) - 1;
        if (!isNaN(itemIdxToSteal) && players[victimIdx].items[itemIdxToSteal]) {
          const stolen = players[victimIdx].items.splice(itemIdxToSteal, 1)[0];
          player.items.push(stolen);
          alert(player.name + " —É–∫—Ä–∞–ª " + stolen + " —É " + players[victimIdx].name);
        }
      }
      break;
    case "–û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω":
      if (chamber.length > 0) {
        const rand = Math.floor(Math.random() * chamber.length);
        alert("–ü–∞—Ç—Ä–æ–Ω #" + (rand + 1) + ": " + (chamber[rand] === 'live' ? "–±–æ–µ–≤–æ–π" : "—Ö–æ–ª–æ—Å—Ç–æ–π"));
      }
      break;
    case "–ò–Ω–≤–µ—Ä—Ç–æ—Ä":
      if (chamber.length > 0) {
        chamber[0] = chamber[0] === 'live' ? 'blank' : 'live';
        alert("–¢–µ–∫—É—â–∏–π –ø–∞—Ç—Ä–æ–Ω –∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω.");
        updateChamber();
      }
      break;
    case "–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω–æ–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–æ":
      if (Math.random() < 0.5) {
        player.hearts += 2;
        alert(player.name + " –ø–æ–ª—É—á–∞–µ—Ç +2 –∑–¥–æ—Ä–æ–≤—å—è.");
      } else {
        player.hearts = Math.max(0, player.hearts - 1);
        alert(player.name + " —Ç–µ—Ä—è–µ—Ç 1 –∑–¥–æ—Ä–æ–≤—å–µ.");
      }
      break;
  }
  player.items.splice(itemIdx, 1);
  updatePlayers();
}

</script>
</body>
</html>
